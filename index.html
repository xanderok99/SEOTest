<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Domain Comparison Tool</title>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tailwindcss-jit-cdn"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#1E3A8A', // blue
              secondary: '#60A5FA',
            },
          },
        },
      };
    </script>
  </head>
  <body class="bg-blue-50 text-gray-800">
    <div class="max-w-7xl mx-auto py-8 px-4">
      <h1 class="text-3xl font-bold text-primary mb-6">Domain Comparison Tool</h1>

      <!-- Upload Section -->
      <div class="mb-6 space-y-4">
        <div>
          <label class="block font-semibold text-primary mb-2">Upload CSVs for Websites</label>
          <input id="csvFiles" type="file" multiple accept=".csv" class="file-input file-input-bordered file-input-primary w-full" />
        </div>

        <div>
          <label class="block font-semibold text-primary mb-2">Or paste sheet-style data below:</label>
          <textarea id="pastedData" rows="5" class="w-full textarea textarea-primary" placeholder="Paste domains in tabular format (e.g. copied from Excel)"></textarea>
        </div>

        <button onclick="handleDataInput()" class="btn btn-primary mt-2">Process Data</button>
      </div>

      <!-- Filters -->
      <div class="my-6">
        <label class="block font-semibold text-primary mb-2">Filter Options:</label>
        <select id="filterType" class="select select-primary w-full max-w-md">
          <option value="similar">Similar Domains on All Websites</option>
          <option value="unsimilar">Domains Not Shared Across Any Website</option>
          <option value="unsimilar_from_one">Domains Unique to One Website</option>
        </select>
      </div>

      <!-- Table Results -->
      <div class="overflow-auto">
        <table id="resultTable" class="table w-full table-zebra border border-blue-200">
          <thead class="bg-blue-200 text-blue-900"></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-blue-100 mt-12 py-6 text-center text-sm text-primary">
      &copy; 2025 YourWebsite.com — All rights reserved.
    </footer>

    <script>
      let dataMatrix = [];
      function handleDataInput() {
        dataMatrix = []; // reset

        const files = document.getElementById('csvFiles').files;
        const pasted = document.getElementById('pastedData').value.trim();

        if (files.length > 0) {
          let fileReadCount = 0;
          for (let i = 0; i < files.length; i++) {
            Papa.parse(files[i], {
              complete: (result) => {
                const flatDomains = result.data.map(row => row[0]?.trim()).filter(Boolean);
                dataMatrix[i] = flatDomains;
                fileReadCount++;
                if (fileReadCount === files.length) showFilteredData();
              },
            });
          }
        } else if (pasted) {
          const lines = pasted.split('\n').filter(Boolean);
          lines.forEach((line, i) => {
            const cols = line.split(/\t|,/).map(col => col.trim());
            cols.forEach((val, j) => {
              if (!dataMatrix[j]) dataMatrix[j] = [];
              if (val) dataMatrix[j].push(val);
            });
          });
          showFilteredData();
        } else {
          alert('Please upload a CSV file or paste domain data.');
        }
      }

      function showFilteredData() {
        const filterType = document.getElementById('filterType').value;
        const tableHead = document.querySelector('#resultTable thead');
        const tableBody = document.querySelector('#resultTable tbody');

        // Clear old
        tableHead.innerHTML = '';
        tableBody.innerHTML = '';

        if (dataMatrix.length === 0) return;

        const headers = dataMatrix.map((_, i) => `Website ${i + 1}`);
        const domainSetPerBrand = dataMatrix.map(set => new Set(set));

        const allDomains = [...new Set(dataMatrix.flat())];
        let filtered = [];

        if (filterType === 'similar') {
          filtered = allDomains.filter(domain => domainSetPerBrand.every(set => set.has(domain)));
        } else if (filterType === 'unsimilar') {
          filtered = allDomains.filter(domain => domainSetPerBrand.filter(set => set.has(domain)).length === 1);
        } else if (filterType === 'unsimilar_from_one') {
          filtered = allDomains.filter(domain => domainSetPerBrand.some(set => set.has(domain)) && domainSetPerBrand.filter(set => set.has(domain)).length === 1);
        }

        // Add Header Row
        const headerRow = `<tr><th>Domain</th>${headers.map(h => `<th>${h}</th>`).join('')}</tr>`;
        tableHead.innerHTML = headerRow;

        // Add Filtered Results
        filtered.forEach(domain => {
          const row = [`<td>${domain}</td>`];
          dataMatrix.forEach(set => {
            row.push(`<td>${set.includes(domain) ? '✔️' : ''}</td>`);
          });
          tableBody.innerHTML += `<tr>${row.join('')}</tr>`;
        });
      }
    </script>
  </body>
</html>
